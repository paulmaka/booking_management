<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Auth</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body { font-family: Inter, Arial, sans-serif; background:#f5f7fb; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; }
        .container { background:#fff; width:320px; padding:24px; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.08); }
        h2 { margin:0 0 12px; text-align:center; font-weight:600; }
        form { display:flex; flex-direction:column; }
        input { margin:6px 0; padding:10px; border:1px solid #e4e7ee; border-radius:10px; outline:none; }
        input:focus { border-color:#7aa2ff; box-shadow:0 0 0 3px rgba(122,162,255,.18); }
        button { margin-top:12px; padding:12px; border:none; border-radius:10px; background:#2573ff; color:#fff; font-weight:600; cursor:pointer; }
        button:hover { filter:brightness(.95); }
        .muted { margin-top:12px; text-align:center; color:#6b7280; cursor:pointer; }
        .error { margin-top:8px; color:#b91c1c; font-size:12px; min-height:16px; }
        .ok { margin-top:8px; color:#065f46; font-size:12px; min-height:16px; }
    </style>
</head>
<body>
<div class="container">
    <h2 id="form-title">Вход</h2>

    <form id="login-form">
        <input type="email" id="login-email" placeholder="Email" required />
        <input type="password" id="login-password" placeholder="Пароль" required />
        <button type="submit">Войти</button>
        <div class="error" id="login-error"></div>
        <div class="ok" id="login-ok"></div>
    </form>

    <form id="register-form" style="display:none;">
        <input type="text" id="register-username" placeholder="Имя" required />
        <input type="email" id="register-email" placeholder="Email" required />
        <input type="password" id="register-password" placeholder="Пароль" required />
        <button type="submit">Создать аккаунт</button>
        <div class="error" id="register-error"></div>
        <div class="ok" id="register-ok"></div>
    </form>

    <div class="muted" id="toggle-link">Создать аккаунт</div>
</div>

<script>
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const toggleLink = document.getElementById('toggle-link');
    const formTitle = document.getElementById('form-title');
    const loginError = document.getElementById('login-error');
    const loginOk = document.getElementById('login-ok');
    const registerError = document.getElementById('register-error');
    const registerOk = document.getElementById('register-ok');

    let showRegister = false;
    toggleLink.addEventListener('click', () => {
        showRegister = !showRegister;
        if (showRegister) {
            loginForm.style.display = 'none';
            registerForm.style.display = 'flex';
            formTitle.textContent = 'Регистрация';
            toggleLink.textContent = 'Уже есть аккаунт? Войти';
        } else {
            loginForm.style.display = 'flex';
            registerForm.style.display = 'none';
            formTitle.textContent = 'Вход';
            toggleLink.textContent = 'Создать аккаунт';
        }
        [loginError, loginOk, registerError, registerOk].forEach(el => el.textContent = '');
    });

    const API_BASE = '/auth';

    async function jsonOrText(res) {
        const ct = res.headers.get('content-type') || '';
        if (ct.includes('application/json')) return res.json();
        return res.text();
    }

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        loginError.textContent = ''; loginOk.textContent = '';
        try {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            const res = await fetch(`${API_BASE}/login`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const body = await jsonOrText(res);
            if (!res.ok) throw new Error(typeof body === 'string' ? body : (body?.message || 'Ошибка входа'));
            const token = body.token;
            localStorage.setItem('token', token);
            loginOk.textContent = 'Успешный вход.';
        } catch (err) {
            loginError.textContent = err.message;
        }
    });

    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        registerError.textContent = ''; registerOk.textContent = '';
        try {
            const username = document.getElementById('register-username').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const res = await fetch(`${API_BASE}/register`, {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name: username, email, password })
            });
            const body = await jsonOrText(res);
            if (!res.ok) throw new Error(typeof body === 'string' ? body : (body?.message || 'Ошибка регистрации'));
            const token = body.token;
            localStorage.setItem('token', token);
            registerOk.textContent = 'Аккаунт создан.';
        } catch (err) {
            registerError.textContent = err.message;
        }
    });
</script>
</body>
</html>
